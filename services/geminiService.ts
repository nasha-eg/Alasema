
import { GoogleGenAI } from "@google/genai";

const ai = new GoogleGenAI({ apiKey: process.env.API_KEY || '' });

export const getDesignAdvice = async (message: string) => {
  try {
    const response = await ai.models.generateContent({
      model: "gemini-3-flash-preview",
      contents: message,
      config: {
        systemInstruction: `أنت المساعد الذكي لشركة العاصمة للفحم (Al-Asimh Charcoal). 
تخصصك: تقديم استشارات احترافية في أنواع الفحم (برتقال، ليمون، مشاوي، مضغوط) ومواصفات التصدير العالمية.
السمات: عملي، سريع البديهة، خبير تقني، ولبق جداً.
المصطلحات المفضلة: 'نخب أول'، 'فرز يدوي'، 'خالٍ من الأتربة'، 'نسبة الكربون'، 'تبخير الحاويات'، 'شهادة المنشأ'.

قواعد الرد:
1. كن مقتضباً ومفيداً.
2. إذا سأل العميل عن السعر، أخبره أن الأسعار مرتبطة بالبورصة اليومية والكمية، ويجب عليه التواصل فوراً عبر واتساب للحصول على السعر النهائي.
3. وجه العميل دائماً وبشكل متكرر لزر 'واتساب' الأخضر أو زر 'اتصال' الموجودين في أسفل الموقع للحصول على رد فوري من فريق المبيعات.
4. أكد للعميل أننا نوفر عينات مجانية للتجار الجادين، ويمكن ترتيب ذلك عبر الواتساب.
5. لا تقدم وعوداً نهائية بالأسعار هنا، بل قل 'سأقوم بتحويلك لمدير المبيعات عبر الواتساب لتأكيد السعر الحالي'.`,
        temperature: 0.7,
      },
    });
    return response.text;
  } catch (error) {
    console.error("Gemini API Error:", error);
    return "نعتذر، نظام الاستشارات الذكي مشغول بتجهيز الشحنات حالياً. يرجى التواصل معنا مباشرة عبر واتساب (الأيقونة الخضراء في الأسفل) للحصول على رد فوري وأسعار البورصة.";
  }
};
